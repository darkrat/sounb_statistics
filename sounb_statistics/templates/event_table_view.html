{% csrf_token %}
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.23/css/dataTables.bootstrap4.min.css" crossorigin="anonymous">

{% load static %}

<script src="https://code.jquery.com/jquery-3.5.1.js" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.js" ></script>
<script src="https://cdn.datatables.net/1.10.23/js/jquery.dataTables.min.js" crossorigin="anonymous"></script>
<script src="https://cdn.datatables.net/1.10.23/js/dataTables.bootstrap4.min.js" crossorigin="anonymous"></script>
<script src="https://cdn.datatables.net/responsive/2.2.5/js/dataTables.responsive.js" ></script>
<script src="https://cdn.datatables.net/buttons/1.6.2/js/dataTables.buttons.js" ></script>
<script src="https://cdn.datatables.net/select/1.3.1/js/dataTables.select.js" ></script>
<script src="{% static 'js/dataTables.altEditor.free.js'%}" crossorigin="anonymous"></script>
<script>
  
$(document).ready(function() {
  var departments, eventtypes, eventforms, themes

  

  $.get("api/operator/eventtypes", function(data) {
    eventtypes = data.data
  });

  $.get("api/operator/eventforms", function(data) {
    eventforms = data.data
  });

  $.get("api/operator/themes", function(data) {
    themes = data.data
  });

  var columns = [
    { "data": "Author", "title":"Регистратор мероприятия" 
    },
    { "data": "BooksOnDisplayCount", "title":"Количество выставвленых книг" 
    },
    { "data": "ChildVisitorCount", "title":".. из них детей 14 лет" 
    },
    { "data": "Department_id", 
      "title":"Отдел-организатор", 
      options : function(){
        return $.get("api/operator/departments", function(data) {
          return data.data
        });
      },
      select2 : { width: "100%"},
      render: function (data, type, row, meta) {
          if (departments === undefined) {
            $.get("api/operator/departments", function(data) {
              departments = data.data
            });
          }
          if (data == null || !(data in departments)) return null;
          return departments[data];
      }
    },
    { "data": "Description", "title":"Описание содержания мероприятия" 
    },
    { "data": "EndDate", "title":"Окончание мероприятия" 
    },
    { "data": "EventForm_id", "title":"Форма мероприятия" 
    },
    { "data": "EventType_id", "title":"Тип мероприятия" 
    },
    { "data": "ExpositionTitle", "title":"Название сопровождающей выставки" 
    },
    { "data": "HasPhotos", "title":"Место хранения медиа-отчета" 
    },
    { "data": "HasPoster", "title":"Была ли подготовлена афиша?" 
    },
    { "data": "IssuedBooksCount", "title":"Количество выданных книг" 
    },
    { "data": "JuniorVisitorCount", "title":"..от 14 до 18 лет" 
    },
    { "data": "Location", "title":"Место провидения" 
    },
    { "data": "Owner_id", "title":"Оператор" 
    },
    { "data": "StartDate", "title":"Начало мероприятия" 
    },
    { "data": "Title", "title":"Название мероприятия" 
    },
    { "data": "VisitorCount", "title":"Количество участников" 
    },
    { "data": "id", "title":"Идентификатор" }
     {% comment %},
     { "data": "Theme", "title":"Тема мероприятия" 
     } {% endcomment %}

  ];

  $('#example').DataTable( {
    "ajax": {
      "url" : "api/operator/events",
      "type": "get",
      'beforeSend': function (request) {
        request.setRequestHeader("api-csrftoken", '{{ csrf_token }}');
      }
    },
    scrollY: 800,
    columns: columns,
    responsive: true,
    dom: 'Bfrtip',        // Needs button container
    select: 'single',
    altEditor: true,     // Enable altEditor
    "language": {
            "search": "Поиск:",
            "lengthMenu": "Отображать _MENU_ мероприятий на стринице",
            "zeroRecords": "Мероприятий по заданным параметрам не найдено",
            "info": "Отображается страница № _PAGE_ из _PAGES_",
            "infoEmpty": "Нет доступный записей",
            "infoFiltered": "(filtered from _MAX_ total records)",
            "paginate": {
                "first":      "Первая",
                "last":       "Последняя",
                "next":       "Следующая",
                "previous":   "Предидущая"
            },
            "altEditor" : {
              "modalClose" : "Закрыть",
              "edit" : {
                  "title" : "Редактировать",
                  "button" : "Редактировать"
              },
              "add" : {
                  "title" : "Добавить",
                  "button" : "Добавить"
              },
              "delete" : {
                  "title" : "Удалить",
                  "button" : "Удалить"
              },
              "success" : "Данные сохранены",
              "error" : {
                  "message" : "Данные не коректны. Исправте ошибки и попробуйте снова",
                  "label" : "Ошибка",
                  "responseCode" : "Ответ от сервера:",
                  "required" : "Обязательное поле",
                  "unique" : "Дабликат"
              }
            }
    },
    buttons: [
            {
                text: 'Добавить',
                name: 'add'        // do not change name
            },
            {
                extend: 'selected', // Bind to Selected row
                text: 'Редактировать',
                name: 'edit'        // do not change name
            },
            {
                extend: 'selected', // Bind to Selected row
                text: 'Удалить',
                name: 'delete'      // do not change name
            },
            {
                text: 'Обновить',
                name: 'refresh'      // do not change name
            }
        ],
    onAddRow: function(datatable, rowdata, success, error) {
            $.ajax({
                // a tipycal url would be / with type='PUT'
                url: url_ws_mock_ok,
                type: 'GET',
                data: rowdata,
                success: success,
                error: error
            });
        },
    onDeleteRow: function(datatable, rowdata, success, error) {
        $.ajax({
            // a tipycal url would be /{id} with type='DELETE'
            url: url_ws_mock_ok,
            type: 'GET',
            data: rowdata,
            success: success,
            error: error
        });
      },
    onEditRow: function(datatable, rowdata, success, error) {
        $.ajax({
            // a tipycal url would be /{id} with type='POST'
            url: url_ws_mock_ok,
            type: 'GET',
            data: rowdata,
            success: success,
            error: error
        });
      }
  });
});
</script>
<table id="example" class="table table-striped table-bordered dt-responsive nowrap"
       cellspacing="0" >
       
       </table>